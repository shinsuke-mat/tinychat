{"ts":1377930447630,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1377930450792,"patch":[[{"diffs":[[1,"\tvar latitude = 0;\r\n\tvar longitude = 0;\r\n\tvar dateFormat = new DateFormat('yyyy/MM/dd HH:mm:ss');\r\n\r\n\t$(function() {\r\n\t\tsetupWebSocket();\r\n\t})\r\n\r\n\tfunction setupWebSocket() {\r\n\t\t// WebSocket作成\r\n\t\t//var ws = new WebSocket('ws://157.1.147.106:8080/tinychat/eee');\r\n\t\t//var ws = new WebSocket('ws://127.0.0.1:8080/tinychat/eee');\r\n\t\t//var ws = new WebSocket('ws://133.30.159.193:8080/tinychat/eee');\r\n\t\t//var ws = new WebSocket('ws://192.168.0.220:8080/tinychat/eee');\r\n\t\t//var ws = new WebSocket('ws://133.30.159.202:8080/tinychat01/eee');\r\n\t\t//var ws = new WebSocket('ws://127.0.0.1:8080/tinychat/send');\r\n\t\tvar ws = new WebSocket('ws://133.30.159.3:8080/tinychat/send');\r\n\r\n\t\t// WebSocket open時の処理\r\n\t\tws.onopen = function() {\r\n\t\t\t$('#error').html('接続成功');\r\n\t\t}\r\n\r\n\t\t// WebSocket message受信時の処理\r\n\t\tws.onmessage = function(message) {\r\n\t\t\tconsole.log(message.data);\r\n\t\t\tvar json = JSON.parse(message.data);\r\n\r\n\t\t\t$('#log').prepend('<tr>'+\r\n\t\t\t\t\t'<td>' + json.uid + '</td>' +\r\n\t\t\t\t\t'<td>' + json.body + '</td>' +\r\n\t\t\t\t\t'<td>' + json.date + '</td>' +\r\n\t\t\t\t\t'<td>' + json.latitude + '</td>' +\r\n\t\t\t\t\t'<td>' + json.longitude + '</td>' +\r\n\t\t\t\t\t'</tr>');\r\n\t\t}\r\n\r\n\t\t// WebSocket error時の処理\r\n\t\tws.onerror = function() {\r\n\t\t\t$('#error').html('onerror');\r\n\t\t}\r\n\r\n\t\t// WebSocket close時のイベントハンドラ登録\r\n\t\tws.onclose = function() {\r\n\t\t\t$('#error').html('onclose');\r\n\t\t}\r\n\r\n\t\t// ブラウザを閉じた時のイベントを設定\r\n\t\t$(window).unload(function() {\r\n\t\t\tws.onclose();\r\n\t\t})\r\n\r\n\t\t// キー入力時のイベントを設定\r\n\t\t$('#send').submit(function(e) {\r\n\t\t\tvar uid = $('#uid').val();\r\n\t\t\tvar body = $('#body').val();\r\n\t\t\tvar date = dateFormat.format(new Date());\r\n\r\n\t\t\t// WebSocketを使い 'uid\\nmsg' の形式のメッセージをサーバに送信\r\n\t\t\tws.send('{\"uid\":\"'     + uid       + '\",' +\r\n\t\t\t\t\t'\"body\":\"'     + body      + '\",' +\r\n\t\t\t\t\t'\"date\":\"'     + date      + '\",' +\r\n\t\t\t\t\t'\"latitude\":'  + latitude  + ',' +\r\n\t\t\t\t\t'\"longitude\":' + longitude + '}');\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t}"]],"start1":0,"start2":0,"length1":0,"length2":1891}]],"length":1891,"saved":false}
{"ts":1377930479621,"patch":[[{"diffs":[[-1,"\t"],[0,"var latitude"]],"start1":0,"start2":0,"length1":13,"length2":12},{"diffs":[[0,"atitude = 0;"],[-1,"\r\n\t"],[1,"\n"],[0,"var longitud"]],"start1":5,"start2":5,"length1":27,"length2":25},{"diffs":[[0,"ude = 0;"],[-1,"\r\n\t"],[1,"\n"],[0,"var date"]],"start1":28,"start2":28,"length1":19,"length2":17},{"diffs":[[0,"mm:ss');"],[-1,"\r\n\r\n\t"],[1,"\n\n"],[0,"$(functi"]],"start1":84,"start2":84,"length1":21,"length2":18},{"diffs":[[0,"tion() {"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"setupWeb"]],"start1":100,"start2":100,"length1":20,"length2":21},{"diffs":[[0,"t();"],[-1,"\r\n\t})\r\n\r\n\t"],[1,"\n});\n\n"],[0,"func"]],"start1":126,"start2":126,"length1":18,"length2":14},{"diffs":[[0,"cket() {"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"// WebSo"]],"start1":155,"start2":155,"length1":20,"length2":21},{"diffs":[[0,"Socket作成"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"//var ws"]],"start1":174,"start2":174,"length1":20,"length2":21},{"diffs":[[0,"/tinychat/eee');"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"//var ws = new W"]],"start1":236,"start2":236,"length1":36,"length2":37},{"diffs":[[0,"/tinychat/eee');"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"//var ws = new W"]],"start1":302,"start2":302,"length1":36,"length2":37},{"diffs":[[0,"/tinychat/eee');"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"//var ws = new W"]],"start1":373,"start2":373,"length1":36,"length2":37},{"diffs":[[0,"ychat/eee');"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"//var ws = n"]],"start1":447,"start2":447,"length1":28,"length2":29},{"diffs":[[0,"1/eee');"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"//var ws"]],"start1":524,"start2":524,"length1":20,"length2":21},{"diffs":[[0,"/send');"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"var ws ="]],"start1":591,"start2":591,"length1":20,"length2":21},{"diffs":[[0,"/send');"],[-1,"\r\n\r\n\t\t"],[1,"\n\n    "],[0,"// WebSo"]],"start1":659,"start2":659,"length1":22,"length2":22},{"diffs":[[0,"ket open時の処理"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"ws.onopen = "]],"start1":682,"start2":682,"length1":28,"length2":29},{"diffs":[[0,"n = function() {"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"$('#error').html"]],"start1":707,"start2":707,"length1":37,"length2":41},{"diffs":[[0,"'接続成功');"],[-1,"\r\n\t\t}\r\n\r\n\t\t"],[1,"\n    }\n\n    "],[0,"// WebSo"]],"start1":749,"start2":749,"length1":27,"length2":28},{"diffs":[[0,"essage受信時の処理"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"ws.onmessage"]],"start1":783,"start2":783,"length1":28,"length2":29},{"diffs":[[0,"ssage) {"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"console."]],"start1":826,"start2":826,"length1":21,"length2":25},{"diffs":[[0,"e.data);"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"var json"]],"start1":861,"start2":861,"length1":21,"length2":25},{"diffs":[[0,"e.data);"],[-1,"\r\n\r\n\t\t\t"],[1,"\n\n        "],[0,"$('#log'"]],"start1":906,"start2":906,"length1":23,"length2":26},{"diffs":[[0,"d('<tr>'"],[-1,"+\r\n\t\t\t\t\t"],[1," + "],[0,"'<td>' +"]],"start1":940,"start2":940,"length1":24,"length2":19},{"diffs":[[0,".uid + '</td>' +"],[-1,"\r\n\t\t\t\t\t"],[1," "],[0,"'<td>' + json.bo"]],"start1":964,"start2":964,"length1":39,"length2":33},{"diffs":[[0,"body + '</td>' +"],[-1,"\r\n\t\t\t\t\t"],[1," "],[0,"'<td>' + json.da"]],"start1":995,"start2":995,"length1":39,"length2":33},{"diffs":[[0,"date + '</td>' +"],[-1,"\r\n\t\t\t\t\t"],[1," "],[0,"'<td>' + json.la"]],"start1":1026,"start2":1026,"length1":39,"length2":33},{"diffs":[[0,"</td>' +"],[-1,"\r\n\t\t\t\t\t"],[1," "],[0,"'<td>' +"]],"start1":1069,"start2":1069,"length1":23,"length2":17},{"diffs":[[0,"</td>' +"],[-1,"\r\n\t\t\t\t\t"],[1," "],[0,"'</tr>')"]],"start1":1105,"start2":1105,"length1":23,"length2":17},{"diffs":[[0,"</tr>');"],[-1,"\r\n\t\t}\r\n\r\n\t\t"],[1,"\n    }\n\n    "],[0,"// WebSo"]],"start1":1115,"start2":1115,"length1":27,"length2":28},{"diffs":[[0,"rror時の処理"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"ws.onerr"]],"start1":1149,"start2":1149,"length1":20,"length2":21},{"diffs":[[0,"r = function() {"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"$('#error').html"]],"start1":1171,"start2":1171,"length1":37,"length2":41},{"diffs":[[0,"error');"],[-1,"\r\n\t\t}\r\n\r\n\t\t"],[1,"\n    }\n\n    "],[0,"// WebSo"]],"start1":1216,"start2":1216,"length1":27,"length2":28},{"diffs":[[0,"ントハンドラ登録"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"ws.onclo"]],"start1":1258,"start2":1258,"length1":20,"length2":21},{"diffs":[[0,"tion() {"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"$('#erro"]],"start1":1288,"start2":1288,"length1":21,"length2":25},{"diffs":[[0,"e');"],[-1,"\r\n\t\t}\r\n\r\n\t\t"],[1,"\n    }\n\n    "],[0,"// ブ"]],"start1":1329,"start2":1329,"length1":19,"length2":20},{"diffs":[[0,"のイベントを設定"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"$(window"]],"start1":1357,"start2":1357,"length1":20,"length2":21},{"diffs":[[0,"tion() {"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"ws.onclo"]],"start1":1391,"start2":1391,"length1":21,"length2":25},{"diffs":[[0,"e();"],[-1,"\r\n\t\t})\r\n\r\n\t\t"],[1,"\n    })\n\n    "],[0,"// キ"]],"start1":1417,"start2":1417,"length1":20,"length2":21},{"diffs":[[0,"のイベントを設定"],[-1,"\r\n\t\t"],[1,"\n    "],[0,"$('#send"]],"start1":1442,"start2":1442,"length1":20,"length2":21},{"diffs":[[0,"ion(e) {"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"var uid "]],"start1":1478,"start2":1478,"length1":21,"length2":25},{"diffs":[[0,"uid').val();"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"var body = $"]],"start1":1509,"start2":1509,"length1":29,"length2":33},{"diffs":[[0,").val();"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"var date"]],"start1":1550,"start2":1550,"length1":21,"length2":25},{"diffs":[[0,"());"],[-1,"\r\n\r\n\t\t\t"],[1,"\n\n        "],[0,"// W"]],"start1":1604,"start2":1604,"length1":15,"length2":18},{"diffs":[[0,"ジをサーバに送信"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"ws.send("]],"start1":1653,"start2":1653,"length1":21,"length2":25},{"diffs":[[0,"\":\"'"],[-1,"    "],[0," + uid "],[-1,"      "],[0,"+ '\",' +"],[-1,"\r\n\t\t\t\t\t"],[1," "],[0,"'\"bo"]],"start1":1684,"start2":1684,"length1":40,"length2":24},{"diffs":[[0,"\":\"'"],[-1,"    "],[0," + body "],[-1,"     "],[0,"+ '\",' +"],[-1,"\r\n\t\t\t\t\t"],[1," "],[0,"'\"da"]],"start1":1710,"start2":1710,"length1":40,"length2":25},{"diffs":[[0,"\":\"'"],[-1,"    "],[0," + date "],[-1,"     "],[0,"+ '\",' +"],[-1,"\r\n\t\t\t\t\t"],[1," "],[0,"'\"la"]],"start1":1737,"start2":1737,"length1":40,"length2":25},{"diffs":[[0,"itude\":'"],[-1," "],[0," + latit"]],"start1":1763,"start2":1763,"length1":17,"length2":16},{"diffs":[[0,"ude "],[-1," "],[0,"+ ',' +"],[-1,"\r\n\t\t\t\t\t"],[1," "],[0,"'\"lo"]],"start1":1779,"start2":1779,"length1":23,"length2":16},{"diffs":[[0,"}');"],[-1,"\r\n\t\t\t"],[1,"\n        "],[0,"retu"]],"start1":1821,"start2":1821,"length1":13,"length2":17},{"diffs":[[0,"lse;"],[-1,"\r\n\t\t});\r\n\r\n\t"],[1,"\n    });\n\n"],[0,"}"]],"start1":1843,"start2":1843,"length1":17,"length2":15}]],"length":1858,"saved":false}
