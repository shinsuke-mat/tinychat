{"ts":1378023429165,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"// 自分の緯度経度情報\nvar lat = 0; // 緯度\nvar lon = 0; // 経度\nvar dateFormat = new DateFormat('yyyy/MM/dd HH:mm:ss');\nvar ws;\n\n// ページロード完了後のready関数（初期化関数）\n$(function() {\n    // ステータス表示領域を初期にセット\n    $('#status').html('not connected');\n    \n    // WebSocketのセットアップ\n    setupWebSocket();\n    \n    // ブラウザを閉じた時の処理\n    $(window).unload(function() {\n        ws.onclose();\n    })\n    \n    // 送信ボタン押下時のイベントを設定\n    $('#send').submit(function(e) {\n        sendMessage();\n        return false; //submitボタン押下後のページ更新回避\n    });\n});\n\n// WebSocketのセットアップメソッド\nfunction setupWebSocket() {\n    // WebSocket作成\n    ws = new WebSocket('ws://133.30.159.3:8080/tinychat00/send');\n\n    // WebSocket open時の処理\n    ws.onopen = function() {\n        $('#status').html('connection success');\n    }\n\n    // WebSocket message受信時の処理\n    ws.onmessage = function(message) {\n        var json = $.parseJSON(message.data);\n\n        // テーブルのフォーマットでlogフィールドに書き出す\n        $('#log > tbody').prepend('<tr>' +\n            '<td>' + json.uid + '</td>' +\n            '<td>' + json.msg + '</td>' +\n            '<td>' + json.date + '</td>' + \n            '<td>' + json.lat + '</td>' +\n            '<td>' + json.lon + '</td>'+ '</tr>');\n    }\n\n    // WebSocket error時の処理\n    ws.onerror = function() {\n        $('#status').html('connection error!');\n    }\n\n    // WebSocket close時の処理\n    ws.onclose = function() {\n        $('#status').html('connection closed...');\n    }\n}\n\n// WebSocketへのメッセージ送信メソッド\nfunction sendMessage() {\n    var uid = $('#uid').val();\n    var msg = $('#msg').val();\n    var date = dateFormat.format(new Date());\n    \n    // JSON形式のメッセージを生成\n    var message = {uid:uid, msg:msg, date:date, lat:lat, lon:lon};\n    \n    // Stringに変換してサーバに送信\n    ws.send(JSON.stringify(message));\n}"]],"start1":0,"start2":0,"length1":0,"length2":1734}]],"length":1734}
{"contributors":[],"silentsave":false,"ts":1378023454823,"patch":[[{"diffs":[[0,"159."],[-1,"3:8080/tinychat00/send"],[1,"8/************"],[0,"');\n"]],"start1":615,"start2":615,"length1":30,"length2":22}]],"length":1726,"saved":false}
{"ts":1378023814511,"patch":[[{"diffs":[[0,"9.8/"],[-1,"************"],[1,"tinychat00/send"],[0,"');\n"]],"start1":617,"start2":617,"length1":20,"length2":23}]],"length":1729,"saved":false}
{"ts":1378023840100,"patch":[[{"diffs":[[0,"9.8/"],[-1,"tinychat00/send"],[1,"***"],[0,"');\n"]],"start1":617,"start2":617,"length1":23,"length2":11}]],"length":1717,"saved":false}
